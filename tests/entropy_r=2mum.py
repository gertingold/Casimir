#!/usr/bin/python

# This testes compares the entropies for T=300K and R=2µm in the range of
# L=0.2µm...10µm with precomputed values. The precomputed values are in good
# agreement with Fig 4a) in "Thermal Casimir effect for Drude metals in the
# plane-sphere geometry".

from __future__ import division
from Casimir import PerfectReflectors
from math import *
from numpy import linspace,logspace

EPS = 1e-10

hbar = 1.05457173e-34 # Js
kB   = 1.3806488e-23  # J/K
c    = 299792458      # m/s
N    = 100

T_left_SI  = 298
T_right_SI = 302
R_SI = 2e-6

expected = [
    [ 0.2, 3.41404191745 ],
    [ 0.208261703663, 3.40438990116 ],
    [ 0.216864686063, 3.39438174053 ],
    [ 0.225823044919, 3.3845099301 ],
    [ 0.235151460306, 3.37933186382 ],
    [ 0.244865218711, 3.37866853835 ],
    [ 0.254980238083, 3.37664132911 ],
    [ 0.265513093918, 3.38056291559 ],
    [ 0.276481046421, 3.38377185559 ],
    [ 0.287902068790, 3.39249279167 ],
    [ 0.299794876672, 3.40073599685 ],
    [ 0.312178958826, 3.41307632007 ],
    [ 0.325074609064, 3.42889683371 ],
    [ 0.338502959506, 3.44583984763 ],
    [ 0.352486015209, 3.4651777808 ],
    [ 0.367046690224, 3.48591514653 ],
    [ 0.382208845149, 3.50997663081 ],
    [ 0.397997326229, 3.53622348093 ],
    [ 0.414438006069, 3.56458142417 ],
    [ 0.431557826033, 3.59496418463 ],
    [ 0.449384840394, 3.62796806141 ],
    [ 0.467948262304, 3.66210794623 ],
    [ 0.487278511667, 3.69796048407 ],
    [ 0.507407264991, 3.73538983284 ],
    [ 0.528367507290, 3.77375571298 ],
    [ 0.550193586142, 3.81426083207 ],
    [ 0.572921267972, 3.8554534172 ],
    [ 0.596587796663, 3.89753675401 ],
    [ 0.621231954588, 3.94022274065 ],
    [ 0.646894126162, 3.98342796253 ],
    [ 0.673616364020, 4.0265786175 ],
    [ 0.701442457931, 4.07015417086 ],
    [ 0.730418006551, 4.11319377437 ],
    [ 0.760590492152, 4.15556872205 ],
    [ 0.792009358428, 4.19705860986 ],
    [ 0.824726091516, 4.2372582924 ],
    [ 0.858794304372, 4.27589400033 ],
    [ 0.894269824623, 4.31254304199 ],
    [ 0.931210786052, 4.34678992408 ],
    [ 0.969677723863, 4.37848830788 ],
    [ 1.00973367388, 4.40697108879 ],
    [ 1.05144427584, 4.43193106765 ],
    [ 1.09487788096, 4.45291662574 ],
    [ 1.14010566396, 4.46947075867 ],
    [ 1.18720173966, 4.48129252192 ],
    [ 1.23624328447, 4.48780053149 ],
    [ 1.28731066283, 4.48858691657 ],
    [ 1.34048755892, 4.48331357805 ],
    [ 1.39586111380, 4.47147546762 ],
    [ 1.45352206818, 4.45271455129 ],
    [ 1.51356491116, 4.42666874979 ],
    [ 1.57608803501, 4.39299855397 ],
    [ 1.64119389647, 4.35142027479 ],
    [ 1.70898918460, 4.30169211782 ],
    [ 1.77958499564, 4.2436443918 ],
    [ 1.85309701502, 4.17716128613 ],
    [ 1.92964570701, 4.10221481983 ],
    [ 2.00935651204, 4.0188224461 ],
    [ 2.09236005231, 3.9272072685 ],
    [ 2.17879234586, 3.82758867451 ],
    [ 2.26879502938, 3.72030737875 ],
    [ 2.36251559040, 3.60582336588 ],
    [ 2.46010760894, 3.48469575908 ],
    [ 2.56173100916, 3.35758269664 ],
    [ 2.66755232147, 3.22523312915 ],
    [ 2.77774495540, 3.08848003063 ],
    [ 2.89248948376, 2.94821884047 ],
    [ 3.01197393858, 2.80539941828 ],
    [ 3.13639411918, 2.66100314983 ],
    [ 3.26595391310, 2.51602389894 ],
    [ 3.40086563013, 2.37144722923 ],
    [ 3.54135035030, 2.22822973304 ],
    [ 3.68763828611, 2.08727933753 ],
    [ 3.83996915979, 1.94943730021 ],
    [ 3.99859259616, 1.81546298032 ],
    [ 4.16376853165, 1.68602143133 ],
    [ 4.33576764030, 1.56167470125 ],
    [ 4.51487177728, 1.44287681258 ],
    [ 4.70137444078, 1.32997246586 ],
    [ 4.89558125297, 1.2231992555 ],
    [ 5.09781046082, 1.12269301411 ],
    [ 5.30839345761, 1.02849576506 ],
    [ 5.52767532597, 0.9405656716 ],
    [ 5.75601540342, 0.858788328631 ],
    [ 5.99378787113, 0.782988752594 ],
    [ 6.24138236718, 0.712943471147 ],
    [ 6.49920462500, 0.648392192784 ],
    [ 6.76767713829, 0.589048644195 ],
    [ 7.04723985331, 0.534610276958 ],
    [ 7.33835088986, 0.48476665627 ],
    [ 7.64148729199, 0.439206453538 ],
    [ 7.95714580975, 0.397623053154 ],
    [ 8.28584371316, 0.359718856523 ],
    [ 8.62811963994, 0.325208413852 ],
    [ 8.98453447811, 0.293820545884 ],
    [ 9.35567228515, 0.265299628375 ],
    [ 9.74214124510, 0.239406209107 ],
    [ 10.1445746651, 0.215917114143 ],
    [ 10.5636320135, 0.194625181124 ],
    [ 11.0, 0.175338730983 ]
]

for i,L_SI in enumerate(logspace(log(0.2e-6), log(11e-6), N, base=e)):
    ScriptL_SI = R_SI+L_SI
    Q = R_SI/ScriptL_SI

    T_left  = 2*pi*kB/(hbar*c)*ScriptL_SI*T_left_SI
    T_right = 2*pi*kB/(hbar*c)*ScriptL_SI*T_right_SI

    left  = PerfectReflectors(Q=Q, T=T_left, lfac=5)
    right = PerfectReflectors(Q=Q, T=T_right, lfac=5)

    F_left_SI  = left[2] *hbar*c/ScriptL_SI
    F_right_SI = right[2]*hbar*c/ScriptL_SI

    S_SI = - (F_left_SI-F_right_SI)/(T_left_SI-T_right_SI)
    S = S_SI*1e-15/(kB*R_SI**3)
    if abs(1-S/expected[i][1]) > EPS:
        raise BaseException("failed for T=300, R/ScriptL=%g, S_exp=%g, S_calc=%g" % (Q, expected[i][1], S_exp))

print "ok"
